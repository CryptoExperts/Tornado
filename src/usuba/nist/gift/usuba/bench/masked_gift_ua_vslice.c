/* This code was generated by Usuba.
   See https://github.com/DadaIsCrazy/usuba.
   From the file "nist/gift/usuba/ua/gift.ua" (included below). */

#include <stdint.h>

/* Do NOT change the order of those define/include */

#ifndef BITS_PER_REG
#define BITS_PER_REG 32
#endif
/* including the architecture specific .h */
#include "MASKED_UA.h"

/* auxiliary functions */
void SubCells__V32 (/*inputs*/ DATATYPE S0__[MASKING_ORDER],DATATYPE S1__[MASKING_ORDER],DATATYPE S2__[MASKING_ORDER],DATATYPE S3__[MASKING_ORDER], /*outputs*/ DATATYPE S____[4][MASKING_ORDER]) {

  // Variables declaration
  DATATYPE _shadow_S0__2_[MASKING_ORDER];
  DATATYPE _shadow_S1__1_[MASKING_ORDER];
  DATATYPE _shadow_S1__5_[MASKING_ORDER];
  DATATYPE _shadow_S2__3_[MASKING_ORDER];
  DATATYPE _shadow_S2__7_;
  DATATYPE _shadow_S3__4_[MASKING_ORDER];
  DATATYPE _shadow_S3__6_[MASKING_ORDER];
  DATATYPE _tmp1_[MASKING_ORDER];
  DATATYPE _tmp2_[MASKING_ORDER];
  DATATYPE _tmp3_[MASKING_ORDER];
  DATATYPE _tmp4_[MASKING_ORDER];

  // Instructions (body)
  MASKED_AND(_tmp1_,S0__,S2__);
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _shadow_S1__1_[_mask_idx] = XOR(S1__[_mask_idx],_tmp1_[_mask_idx]);
  }
  MASKED_AND(_tmp2_,_shadow_S1__1_,S3__);
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _shadow_S0__2_[_mask_idx] = XOR(S0__[_mask_idx],_tmp2_[_mask_idx]);
    S____[3][_mask_idx] = _shadow_S0__2_[_mask_idx];
  }
  MASKED_OR(_tmp3_,_shadow_S0__2_,_shadow_S1__1_);
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _shadow_S2__3_[_mask_idx] = XOR(S2__[_mask_idx],_tmp3_[_mask_idx]);
    _shadow_S3__4_[_mask_idx] = XOR(S3__[_mask_idx],_shadow_S2__3_[_mask_idx]);
    _shadow_S1__5_[_mask_idx] = XOR(_shadow_S1__1_[_mask_idx],_shadow_S3__4_[_mask_idx]);
    S____[1][_mask_idx] = _shadow_S1__5_[_mask_idx];
  }
  _shadow_S3__6_[0] = NOT(_shadow_S3__4_[0]);
  for (int _mask_idx = 1; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _shadow_S3__6_[_mask_idx] = _shadow_S3__4_[_mask_idx];
  }
  MASKED_AND(_tmp4_,_shadow_S0__2_,_shadow_S1__5_);
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _shadow_S2__7_ = XOR(_shadow_S2__3_[_mask_idx],_tmp4_[_mask_idx]);
    S____[0][_mask_idx] = _shadow_S3__6_[_mask_idx];
    S____[2][_mask_idx] = _shadow_S2__7_;
  }

}

void rowperm__V_Natnat_32 (/*inputs*/ DATATYPE S__[MASKING_ORDER],unsigned int B0_pos__,unsigned int B1_pos__,unsigned int B2_pos__,unsigned int B3_pos__, /*outputs*/ DATATYPE S____[MASKING_ORDER]) {

  // Variables declaration
  DATATYPE T__[MASKING_ORDER];
  DATATYPE _tmp10_[MASKING_ORDER];
  DATATYPE _tmp11_[MASKING_ORDER];
  DATATYPE _tmp12_[MASKING_ORDER];
  DATATYPE _tmp13_[MASKING_ORDER];
  DATATYPE _tmp14_[MASKING_ORDER];
  DATATYPE _tmp15_[MASKING_ORDER];
  DATATYPE _tmp16_[MASKING_ORDER];
  DATATYPE _tmp17_[MASKING_ORDER];
  DATATYPE _tmp18_[MASKING_ORDER];
  DATATYPE _tmp19_[MASKING_ORDER];
  DATATYPE _tmp20_[MASKING_ORDER];
  DATATYPE _tmp21_[MASKING_ORDER];
  DATATYPE _tmp22_[MASKING_ORDER];
  DATATYPE _tmp23_[MASKING_ORDER];
  DATATYPE _tmp5_[MASKING_ORDER];
  DATATYPE _tmp6_[MASKING_ORDER];
  DATATYPE _tmp7_[MASKING_ORDER];
  DATATYPE _tmp8_[MASKING_ORDER];
  DATATYPE _tmp9_[MASKING_ORDER];

  // Instructions (body)
  T__[0] = LIFT_32(0);
  for (int _mask_idx = 1; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    T__[_mask_idx] = LIFT_32(0);
  }
  for (int b__ = 0; b__ <= 7; b__++) {
    for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
      _tmp5_[_mask_idx] = R_SHIFT(S__[_mask_idx],((4 * b__) + 0),32);
      _tmp10_[_mask_idx] = R_SHIFT(S__[_mask_idx],((4 * b__) + 1),32);
      _tmp15_[_mask_idx] = R_SHIFT(S__[_mask_idx],((4 * b__) + 2),32);
      _tmp20_[_mask_idx] = R_SHIFT(S__[_mask_idx],((4 * b__) + 3),32);
    }
    _tmp6_[0] = LIFT_32(1);
    for (int _mask_idx = 1; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
      _tmp6_[_mask_idx] = LIFT_32(0);
      _tmp11_[_mask_idx] = LIFT_32(0);
      _tmp16_[_mask_idx] = LIFT_32(0);
      _tmp21_[_mask_idx] = LIFT_32(0);
    }
    for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
      _tmp7_[_mask_idx] = AND(_tmp5_[_mask_idx],_tmp6_[0]);
      _tmp8_[_mask_idx] = L_SHIFT(_tmp7_[_mask_idx],(b__ + (8 * B0_pos__)),32);
      _tmp9_[_mask_idx] = XOR(T__[_mask_idx],_tmp8_[_mask_idx]);
    }
    _tmp11_[0] = LIFT_32(1);
    for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
      _tmp12_[_mask_idx] = AND(_tmp10_[_mask_idx],_tmp11_[0]);
      _tmp13_[_mask_idx] = L_SHIFT(_tmp12_[_mask_idx],(b__ + (8 * B1_pos__)),32);
      _tmp14_[_mask_idx] = XOR(_tmp9_[_mask_idx],_tmp13_[_mask_idx]);
    }
    _tmp16_[0] = LIFT_32(1);
    for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
      _tmp17_[_mask_idx] = AND(_tmp15_[_mask_idx],_tmp16_[0]);
      _tmp18_[_mask_idx] = L_SHIFT(_tmp17_[_mask_idx],(b__ + (8 * B2_pos__)),32);
      _tmp19_[_mask_idx] = XOR(_tmp14_[_mask_idx],_tmp18_[_mask_idx]);
    }
    _tmp21_[0] = LIFT_32(1);
    for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
      _tmp22_[_mask_idx] = AND(_tmp20_[_mask_idx],_tmp21_[0]);
      _tmp23_[_mask_idx] = L_SHIFT(_tmp22_[_mask_idx],(b__ + (8 * B3_pos__)),32);
      T__[_mask_idx] = XOR(_tmp19_[_mask_idx],_tmp23_[_mask_idx]);
    }
  }
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    S____[_mask_idx] = T__[_mask_idx];
  }

}

void PermBits__V32 (/*inputs*/ DATATYPE S__[4][MASKING_ORDER], /*outputs*/ DATATYPE S____[4][MASKING_ORDER]) {

  // Variables declaration
  unsigned int _tmp111_;
  unsigned int _tmp110_;
  unsigned int _tmp109_;
  unsigned int _tmp108_;
  unsigned int _tmp107_;
  unsigned int _tmp106_;
  unsigned int _tmp105_;
  unsigned int _tmp104_;
  unsigned int _tmp103_;
  unsigned int _tmp102_;
  unsigned int _tmp101_;
  unsigned int _tmp100_;
  unsigned int _tmp99_;
  unsigned int _tmp98_;
  unsigned int _tmp97_;
  unsigned int _tmp96_;

  // Instructions (body)
  _tmp96_ = 0;
  _tmp97_ = 3;
  _tmp98_ = 2;
  _tmp99_ = 1;
  rowperm__V_Natnat_32(S__[0],_tmp96_,_tmp97_,_tmp98_,_tmp99_,S____[0]);
  _tmp100_ = 1;
  _tmp101_ = 0;
  _tmp102_ = 3;
  _tmp103_ = 2;
  rowperm__V_Natnat_32(S__[1],_tmp100_,_tmp101_,_tmp102_,_tmp103_,S____[1]);
  _tmp104_ = 2;
  _tmp105_ = 1;
  _tmp106_ = 0;
  _tmp107_ = 3;
  rowperm__V_Natnat_32(S__[2],_tmp104_,_tmp105_,_tmp106_,_tmp107_,S____[2]);
  _tmp108_ = 3;
  _tmp109_ = 2;
  _tmp110_ = 1;
  _tmp111_ = 0;
  rowperm__V_Natnat_32(S__[3],_tmp108_,_tmp109_,_tmp110_,_tmp111_,S____[3]);

}

void AddRoundKey__V32 (/*inputs*/ DATATYPE S__[4][MASKING_ORDER],DATATYPE W__[8][MASKING_ORDER],DATATYPE rc__[MASKING_ORDER], /*outputs*/ DATATYPE S____[4][MASKING_ORDER]) {

  // Variables declaration
  DATATYPE _tmp40_;
  DATATYPE _tmp41_;
  DATATYPE _tmp42_;
  DATATYPE _tmp43_;
  DATATYPE _tmp45_;
  DATATYPE _tmp112_[MASKING_ORDER];

  // Instructions (body)
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _tmp40_ = L_SHIFT(W__[2][_mask_idx],16,32);
    _tmp41_ = XOR(_tmp40_,W__[3][_mask_idx]);
    S____[2][_mask_idx] = XOR(S__[2][_mask_idx],_tmp41_);
    _tmp42_ = L_SHIFT(W__[6][_mask_idx],16,32);
    _tmp43_ = XOR(_tmp42_,W__[7][_mask_idx]);
    S____[1][_mask_idx] = XOR(S__[1][_mask_idx],_tmp43_);
    S____[0][_mask_idx] = S__[0][_mask_idx];
  }
  _tmp112_[0] = LIFT_32(2147483648);
  for (int _mask_idx = 1; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _tmp112_[_mask_idx] = LIFT_32(0);
  }
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _tmp45_ = XOR(S__[3][_mask_idx],_tmp112_[_mask_idx]);
    S____[3][_mask_idx] = XOR(_tmp45_,rc__[_mask_idx]);
  }

}

void KeyUpdate__V32 (/*inputs*/ DATATYPE W__[8][MASKING_ORDER], /*outputs*/ DATATYPE W____[8][MASKING_ORDER]) {

  // Variables declaration
  DATATYPE _tmp46_;
  DATATYPE _tmp47_;
  DATATYPE _tmp48_[MASKING_ORDER];
  DATATYPE _tmp50_;
  DATATYPE _tmp51_;
  DATATYPE _tmp52_[MASKING_ORDER];
  DATATYPE _tmp114_;
  DATATYPE _tmp113_[MASKING_ORDER];

  // Instructions (body)
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _tmp46_ = R_SHIFT(W__[6][_mask_idx],2,32);
    _tmp47_ = L_SHIFT(W__[6][_mask_idx],14,32);
    _tmp48_[_mask_idx] = XOR(_tmp46_,_tmp47_);
    _tmp50_ = R_SHIFT(W__[7][_mask_idx],12,32);
    _tmp51_ = L_SHIFT(W__[7][_mask_idx],4,32);
    _tmp52_[_mask_idx] = XOR(_tmp50_,_tmp51_);
    W____[7][_mask_idx] = W__[5][_mask_idx];
    W____[6][_mask_idx] = W__[4][_mask_idx];
    W____[5][_mask_idx] = W__[3][_mask_idx];
    W____[4][_mask_idx] = W__[2][_mask_idx];
    W____[3][_mask_idx] = W__[1][_mask_idx];
    W____[2][_mask_idx] = W__[0][_mask_idx];
  }
  _tmp113_[0] = LIFT_32(65535);
  for (int _mask_idx = 1; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    _tmp113_[_mask_idx] = LIFT_32(0);
    _tmp114_ = LIFT_32(0);
  }
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    W____[0][_mask_idx] = AND(_tmp48_[_mask_idx],_tmp113_[0]);
  }
  _tmp114_ = LIFT_32(65535);
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    W____[1][_mask_idx] = AND(_tmp52_[_mask_idx],_tmp114_);
  }

}

/* main function */
void gift__ (/*inputs*/ DATATYPE P__[4][MASKING_ORDER],DATATYPE K__[8][MASKING_ORDER], /*outputs*/ DATATYPE C__[4][MASKING_ORDER]) {

  // Variables declaration
  DATATYPE GIFT_RC__[40][MASKING_ORDER];
  DATATYPE W__[8][MASKING_ORDER];
  DATATYPE _tmp94_[4][MASKING_ORDER];
  DATATYPE _tmp95_[4][MASKING_ORDER];
  DATATYPE round__[4][MASKING_ORDER];

  // Instructions (body)
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    round__[0][_mask_idx] = P__[0][_mask_idx];
    round__[1][_mask_idx] = P__[1][_mask_idx];
    round__[2][_mask_idx] = P__[2][_mask_idx];
    round__[3][_mask_idx] = P__[3][_mask_idx];
    W__[0][_mask_idx] = K__[0][_mask_idx];
    W__[1][_mask_idx] = K__[1][_mask_idx];
    W__[2][_mask_idx] = K__[2][_mask_idx];
    W__[3][_mask_idx] = K__[3][_mask_idx];
    W__[4][_mask_idx] = K__[4][_mask_idx];
    W__[5][_mask_idx] = K__[5][_mask_idx];
    W__[6][_mask_idx] = K__[6][_mask_idx];
    W__[7][_mask_idx] = K__[7][_mask_idx];
  }
  GIFT_RC__[0][0] = LIFT_32(1);
  for (int _mask_idx = 1; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    GIFT_RC__[0][_mask_idx] = LIFT_32(0);
    GIFT_RC__[1][_mask_idx] = LIFT_32(0);
    GIFT_RC__[2][_mask_idx] = LIFT_32(0);
    GIFT_RC__[3][_mask_idx] = LIFT_32(0);
    GIFT_RC__[4][_mask_idx] = LIFT_32(0);
    GIFT_RC__[5][_mask_idx] = LIFT_32(0);
    GIFT_RC__[6][_mask_idx] = LIFT_32(0);
    GIFT_RC__[7][_mask_idx] = LIFT_32(0);
    GIFT_RC__[8][_mask_idx] = LIFT_32(0);
    GIFT_RC__[9][_mask_idx] = LIFT_32(0);
    GIFT_RC__[10][_mask_idx] = LIFT_32(0);
    GIFT_RC__[11][_mask_idx] = LIFT_32(0);
    GIFT_RC__[12][_mask_idx] = LIFT_32(0);
    GIFT_RC__[13][_mask_idx] = LIFT_32(0);
    GIFT_RC__[14][_mask_idx] = LIFT_32(0);
    GIFT_RC__[15][_mask_idx] = LIFT_32(0);
    GIFT_RC__[16][_mask_idx] = LIFT_32(0);
    GIFT_RC__[17][_mask_idx] = LIFT_32(0);
    GIFT_RC__[18][_mask_idx] = LIFT_32(0);
    GIFT_RC__[19][_mask_idx] = LIFT_32(0);
    GIFT_RC__[20][_mask_idx] = LIFT_32(0);
    GIFT_RC__[21][_mask_idx] = LIFT_32(0);
    GIFT_RC__[22][_mask_idx] = LIFT_32(0);
    GIFT_RC__[23][_mask_idx] = LIFT_32(0);
    GIFT_RC__[24][_mask_idx] = LIFT_32(0);
    GIFT_RC__[25][_mask_idx] = LIFT_32(0);
    GIFT_RC__[26][_mask_idx] = LIFT_32(0);
    GIFT_RC__[27][_mask_idx] = LIFT_32(0);
    GIFT_RC__[28][_mask_idx] = LIFT_32(0);
    GIFT_RC__[29][_mask_idx] = LIFT_32(0);
    GIFT_RC__[30][_mask_idx] = LIFT_32(0);
    GIFT_RC__[31][_mask_idx] = LIFT_32(0);
    GIFT_RC__[32][_mask_idx] = LIFT_32(0);
    GIFT_RC__[33][_mask_idx] = LIFT_32(0);
    GIFT_RC__[34][_mask_idx] = LIFT_32(0);
    GIFT_RC__[35][_mask_idx] = LIFT_32(0);
    GIFT_RC__[36][_mask_idx] = LIFT_32(0);
    GIFT_RC__[37][_mask_idx] = LIFT_32(0);
    GIFT_RC__[38][_mask_idx] = LIFT_32(0);
    GIFT_RC__[39][_mask_idx] = LIFT_32(0);
  }
  GIFT_RC__[1][0] = LIFT_32(3);
  GIFT_RC__[2][0] = LIFT_32(7);
  GIFT_RC__[3][0] = LIFT_32(15);
  GIFT_RC__[4][0] = LIFT_32(31);
  GIFT_RC__[5][0] = LIFT_32(62);
  GIFT_RC__[6][0] = LIFT_32(61);
  GIFT_RC__[7][0] = LIFT_32(59);
  GIFT_RC__[8][0] = LIFT_32(55);
  GIFT_RC__[9][0] = LIFT_32(47);
  GIFT_RC__[10][0] = LIFT_32(30);
  GIFT_RC__[11][0] = LIFT_32(60);
  GIFT_RC__[12][0] = LIFT_32(57);
  GIFT_RC__[13][0] = LIFT_32(51);
  GIFT_RC__[14][0] = LIFT_32(39);
  GIFT_RC__[15][0] = LIFT_32(14);
  GIFT_RC__[16][0] = LIFT_32(29);
  GIFT_RC__[17][0] = LIFT_32(58);
  GIFT_RC__[18][0] = LIFT_32(53);
  GIFT_RC__[19][0] = LIFT_32(43);
  GIFT_RC__[20][0] = LIFT_32(22);
  GIFT_RC__[21][0] = LIFT_32(44);
  GIFT_RC__[22][0] = LIFT_32(24);
  GIFT_RC__[23][0] = LIFT_32(48);
  GIFT_RC__[24][0] = LIFT_32(33);
  GIFT_RC__[25][0] = LIFT_32(2);
  GIFT_RC__[26][0] = LIFT_32(5);
  GIFT_RC__[27][0] = LIFT_32(11);
  GIFT_RC__[28][0] = LIFT_32(23);
  GIFT_RC__[29][0] = LIFT_32(46);
  GIFT_RC__[30][0] = LIFT_32(28);
  GIFT_RC__[31][0] = LIFT_32(56);
  GIFT_RC__[32][0] = LIFT_32(49);
  GIFT_RC__[33][0] = LIFT_32(35);
  GIFT_RC__[34][0] = LIFT_32(6);
  GIFT_RC__[35][0] = LIFT_32(13);
  GIFT_RC__[36][0] = LIFT_32(27);
  GIFT_RC__[37][0] = LIFT_32(54);
  GIFT_RC__[38][0] = LIFT_32(45);
  GIFT_RC__[39][0] = LIFT_32(26);
  for (int i__ = 0; i__ <= 39; i__++) {
    SubCells__V32(round__[0],round__[1],round__[2],round__[3],_tmp94_);
    PermBits__V32(_tmp94_,_tmp95_);
    AddRoundKey__V32(_tmp95_,W__,GIFT_RC__[i__],round__);
    KeyUpdate__V32(W__,W__);
  }
  for (int _mask_idx = 0; _mask_idx <= (MASKING_ORDER - 1); _mask_idx++) {
    C__[0][_mask_idx] = round__[0][_mask_idx];
    C__[1][_mask_idx] = round__[1][_mask_idx];
    C__[2][_mask_idx] = round__[2][_mask_idx];
    C__[3][_mask_idx] = round__[3][_mask_idx];
  }

}

/* Additional functions */
uint32_t bench_speed() {
  /* inputs */
  DATATYPE P__[4][MASKING_ORDER] = { 0 };
  DATATYPE K__[8][MASKING_ORDER] = { 0 };
  /* outputs */
  DATATYPE C__[4][MASKING_ORDER] = { 0 };
  /* fun call */
  gift__(P__, K__,C__);

  /* Returning the number of encrypted bytes */
  return 16;
}

/* **************************************************************** */
/*                            Usuba source                          */
/*                                                                  */
/*

 node SubCells(S0 :  v1 :: base,S1 :  v1 :: base,S2 :  v1 :: base,S3 :  v1 :: base)
  returns S' :  v4 :: base
vars

let
  (S1) := (S1 ^ (S0 & S2));
  (S0) := (S0 ^ (S1 & S3));
  (S2) := (S2 ^ (S0 | S1));
  (S3) := (S3 ^ S2);
  (S1) := (S1 ^ S3);
  (S3) := (~ S3);
  (S2) := (S2 ^ (S0 & S1));
  (S') = (S3,S1,S2,S0)
tel

 node rowperm(S :  u32 :: base,B0_pos :  nat :: base,B1_pos :  nat :: base,B2_pos :  nat :: base,B3_pos :  nat :: base)
  returns S' :  u32 :: base
vars
  T :  u32[9] :: base
let
  (T[0]) = 0;
  forall b in [0,7] {
    (T[(b + 1)]) = ((((T[b] ^ (((S >> ((4 * b) + 0)) & 1) << (b + (8 * B0_pos)))) ^ (((S >> ((4 * b) + 1)) & 1) << (b + (8 * B1_pos)))) ^ (((S >> ((4 * b) + 2)) & 1) << (b + (8 * B2_pos)))) ^ (((S >> ((4 * b) + 3)) & 1) << (b + (8 * B3_pos))))
  };
  (S') = T[8]
tel

 node PermBits(S :  u32x4 :: base)
  returns S' :  u32x4 :: base
vars

let
  (S'[0]) = rowperm(S[0],0,3,2,1);
  (S'[1]) = rowperm(S[1],1,0,3,2);
  (S'[2]) = rowperm(S[2],2,1,0,3);
  (S'[3]) = rowperm(S[3],3,2,1,0)
tel

 node AddRoundKey(S :  u32x4 :: base,W :  u32[8] :: base,rc :  u32 :: base)
  returns S' :  u32x4 :: base
vars

let
  (S'[2]) = (S[2] ^ ((W[2] << 16) ^ W[3]));
  (S'[1]) = (S[1] ^ ((W[6] << 16) ^ W[7]));
  (S'[3]) = ((S[3] ^ 2147483648) ^ rc);
  (S'[0]) = S[0]
tel

 node KeyUpdate(W :  u32[8] :: base)
  returns W' :  u32[8] :: base
vars

let
  (W'[0]) = (((W[6] >> 2) ^ (W[6] << 14)) & 65535);
  (W'[1]) = (((W[7] >> 12) ^ (W[7] << 4)) & 65535);
  (W'[7 .. 2]) = W[5 .. 0]
tel

 node gift(P :  u32x4 :: base,K : const u32[8] :: base)
  returns C :  u32x4 :: base
vars
  round :  u32x4[41] :: base,
  W :  u32[41][8] :: base,
  GIFT_RC :  u32[40] :: base
let
  (round[0]) = P;
  (W[0]) = K;
  (GIFT_RC) = (1,3,7,15,31,62,61,59,55,47,30,60,57,51,39,14,29,58,53,43,22,44,24,48,33,2,5,11,23,46,28,56,49,35,6,13,27,54,45,26);
  forall i in [0,39] {
    (round[(i + 1)]) = AddRoundKey(PermBits(SubCells(round[i])),W[i],GIFT_RC[i]);
    (W[(i + 1)]) = KeyUpdate(W[i])
  };
  (C) = round[40]
tel

*/
 